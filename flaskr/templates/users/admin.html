{# templates/rols/admin.html #}
{% extends 'base.html' %}

{% block title %}Admin Panel · StockApp{% endblock %}

{% block header %}
  <h1>Panel de Administración</h1>
  <p class="text-muted">
    Hola {{ g.user['firstname'] or g.user['username'] }}, gestioná tu inventario, compras y ventas.
  </p>
{% endblock %}

{% block content %}

  {# Flash messages #}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-group">
        {% for category, message in messages %}
          <div class="flash flash-{{ category }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {# Accesos rápidos #}
  <section class="quick-actions">
    <ul class="cards">
      <li class="card">
        <h3>Stock</h3>
        <p>Ver/editar productos y existencias.</p>
        <a href="{{ url_for('stock.list') }}">Abrir stock</a>
      </li>
      <li class="card">
        <h3>Compras</h3>
        <p>Registrar compras a proveedores.</p>
        <a href="{{ url_for('purchases.list') }}">Ver compras</a>
      </li>
      <li class="card">
        <h3>Ventas</h3>
        <p>Cargar ventas y tickets.</p>
        <a href="{{ url_for('sales.list') }}">Ver ventas</a>
      </li>
      <li class="card">
        <h3>Usuarios</h3>
        <p>Alta/baja y roles (USER/ADMIN).</p>
        <a href="{{ url_for('users.manage') }}">Administrar usuarios</a>
      </li>
      <li class="card">
        <h3>Reportes</h3>
        <p>KPIs de stock, compras y ventas.</p>
        <a href="{{ url_for('reports.index') }}">Ver reportes</a>
      </li>
    </ul>
  </section>

  {# Métricas rápidas (placeholders) #}
  <section class="metrics">
    <ul class="stats">
      <li><strong>{{ total_products or 0 }}</strong><span>Productos</span></li>
      <li><strong>{{ low_stock_count or 0 }}</strong><span>Con stock bajo</span></li>
      <li><strong>{{ today_sales_count or 0 }}</strong><span>Ventas hoy</span></li>
      <li><strong>{{ today_revenue or 0 }}</strong><span>Ingresos hoy</span></li>
    </ul>
  </section>

  {# Actividad reciente (placeholders) #}
  <section class="recent">
    <h2>Actividad reciente</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Tipo</th>
          <th>Descripción</th>
          <th>Usuario</th>
        </tr>
      </thead>
      <tbody>
        {% for ev in recent_events or [] %}
          <tr>
            <td>{{ ev.created_at }}</td>
            <td>{{ ev.kind }}</td>
            <td>{{ ev.description }}</td>
            <td>{{ ev.username }}</td>
          </tr>
        {% else %}
          <tr><td colspan="4" class="text-muted">Sin actividad reciente.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

{% endblock %}
